"0","data_path <- c(""S:/AG/AG-CSB_NeuroRad2/khalila/MULTIBAND/multiband_data_last"")"
"0","#PATIENTS WITH HYPOPERFUSION IN SESSION 1"
"0","#calculated as above"
"0","#make a DVARS vector with segments name to be concatenated later "
"0","dvars_mean_all_ses1 <- c(segments)"
"0","dvars_max_all_ses1<- c(segments)"
"0","#define two for loops with first one looping through subjects and second one through segments"
"0","for (i in 1:length(subjects)) {"
"0","mean_seg_ses1_dvars <- c()"
"0","max_seg_ses1_dvars<- c()"
"0","      for (x in segments) {"
"0","        #load dvars files from each segment"
"0","        #these are text files showing the framewise displacement of the data, corresponding to the temporal derivative of movement parameters"
"0","      x_i_dvars.txt<- read.csv(paste(data_path,subjects[i], ""session_1"", x, ""dvars.txt"", sep=""/""), sep="";"")"
"0","      nam_mean_x_dvars<- paste(subjects[i], x,""mean"", ""dvars"", sep=""_"")"
"0","    #assign head motion mean dvars to a variable in the for loop"
"0","    assign(nam_mean_x_dvars, mean(x_i_dvars.txt[,1]))"
"0","    #assign head motion max to a variable "
"0","    nam_max_x_dvars<- paste(subjects[i], x, ""max"", ""dvars"", sep=""_"")"
"0","    assign(nam_max_x_dvars, max(x_i_dvars.txt[,1]))"
"0","    #concatenate mean and max values of each segment by rbind for one subject"
"0","    mean_seg_ses1_dvars<- rbind(mean_seg_ses1_dvars, get(nam_mean_x_dvars))"
"0","    max_seg_ses1_dvars<-rbind(max_seg_ses1_dvars, get(nam_max_x_dvars))"
"0","      }"
"0","  #define it as dataframe for one subject with 5 obs. of 1 variable  "
"0","  mean_seg_ses1_dvars <- data.frame(mean_seg_ses1_dvars)"
"0","  #give a column name corresponding to the name of that subject"
"0","  colnames(mean_seg_ses1_dvars) <- subjects[i]"
"0","  #do a cbind with the vector defined before the loop, giving rownames"
"0","  dvars_mean_all_ses1 <- cbind(dvars_mean_all_ses1, mean_seg_ses1_dvars)"
"0","  #same process applies to head motion max"
"0","  max_seg_ses1_dvars<- data.frame(max_seg_ses1_dvars)"
"0","  colnames(max_seg_ses1_dvars) <- subjects[i]"
"0"," dvars_max_all_ses1<-cbind(dvars_max_all_ses1, max_seg_ses1_dvars)"
"0"," "
"0","}"
"0","#PATIENTS WITH HYPOPERFUSION IN SESSION 1 AND 2"
"0","#pull the data consisting of subject names"
"0","#this is factor vector of 12 levels"
"0","subjects_2<-read.csv(paste(data_path, ""new_day1_2"", sep=""/""),sep="";"",header=F)$V1"
"0","#define two vectors with segment names"
"0","dvars_max_all_ses2<- c(segments)"
"0","dvars_mean_all_ses2<- c(segments)"
"0","#make two for loops one for subject smaller one for segments"
"0","for (i in 1:length(subjects_2)) {"
"0","mean_seg_ses2_dvars<- c()"
"0","max_seg_ses2_dvars<- c()"
"0","   "
"0","    for (z in segments){"
"0","        z_i_dvars.txt<- read.csv(paste(data_path, subjects_2[i], ""session_2"", z, ""dvars.txt"", sep=""/""))"
"0","        #assign the head motion mean to a variable"
"0","        nam_mean_z_dvars<- paste(subjects_2[i], z, ""mean"",""dvars"", sep=""_"")"
"0","        assign(nam_mean_z_dvars, mean(z_i_dvars.txt[,1]))"
"0","        #head motion max to a variable"
"0","        nam_max_z_dvars<- paste(subjects_2[i], z, ""max"", ""dvars"", sep=""_"")"
"0","        assign(nam_max_z_dvars, max(z_i_dvars.txt[,1]))"
"0","        #concetenate empty vectors"
"0","    mean_seg_ses2_dvars<- rbind(mean_seg_ses2_dvars, get(nam_mean_z_dvars))"
"0","    max_seg_ses2_dvars<-rbind(max_seg_ses2_dvars, get(nam_max_z_dvars))"
"0","        }"
"0","  "
"0","mean_seg_ses2_dvars<-data.frame(mean_seg_ses2_dvars) "
"0","  colnames(mean_seg_ses2_dvars) <- subjects_2[i]"
"0"," dvars_mean_all_ses2 <- cbind(dvars_mean_all_ses2, mean_seg_ses2_dvars)"
"0","  max_seg_ses2_dvars<- data.frame(max_seg_ses2_dvars)"
"0","  colnames(max_seg_ses2_dvars) <- subjects_2[i]"
"0","  dvars_max_all_ses2<- cbind(dvars_max_all_ses2, max_seg_ses2_dvars)"
"0","}"
"0","#add a vector to volumes_output dataframe consisting of thresholds applied"
"0","volumes_output$thr<-gsub('.*(46).*', '46', volumes_output$Mask)"
"0","volumes_output$thr<-gsub('.*(23).*', '23', volumes_output$thr)"
"0","volumes_output$thr<-gsub('.*(0).*', '0', volumes_output$thr)"
"0","volumes_output$thr<- as.factor(volumes_output$thr)"
"0","#dvars_mean/max_all_ses1/ses2 are data frames with segments being colnames, they need to be transposed for further analysis"
"0","#First columns are got rid of and and the data frames are transposed. Outcomes are then rbinded inn a way where ses1 is above ses2 for mean and max data separately"
"0","trans_mean_ses1_dvars<-as.data.frame(t(dvars_mean_all_ses1[,-1]))"
"0","trans_mean_ses2_dvars<-as.data.frame(t(dvars_mean_all_ses2[,-1]))"
"0","trans_max_ses1_dvars<- as.data.frame(t(dvars_max_all_ses1[,-1]))"
"0","trans_max_ses2_dvars<-as.data.frame(t(dvars_max_all_ses2[,-1]))"
"0","trans_mean_ses12_dvars<-rbind(as.data.frame(t(dvars_mean_all_ses1[,-1])),as.data.frame(t(dvars_mean_all_ses2[,-1])))"
"0","trans_max_ses12_dvars<-rbind(as.data.frame(t(dvars_max_all_ses1[,-1])),as.data.frame(t(dvars_max_all_ses2[,-1])))"
"0","#colnames for trans"
"0","colnames(trans_mean_ses1_dvars)<- c(""RS_A"", ""RS_B"", ""RS_C"", ""RS_D"", ""RS_E"")"
"0","colnames(trans_mean_ses2_dvars)<- c(""RS_A"", ""RS_B"", ""RS_C"", ""RS_D"", ""RS_E"")"
"0","colnames(trans_max_ses1_dvars)<- c(""RS_A"", ""RS_B"", ""RS_C"", ""RS_D"", ""RS_E"")"
"0","colnames(trans_max_ses2_dvars)<- c(""RS_A"", ""RS_B"", ""RS_C"", ""RS_D"", ""RS_E"")"
"0","#boxplot head motion mean and max data (ses 1 and 2) across segments "
"0","boxplot(trans_mean_ses12_dvars, names = c(""0.2 scan"", ""0.4 scan"", ""0.6 scan"", ""0.8 scan"", ""full scan""), ylab=""Head Motion Mean DVARS"")"
